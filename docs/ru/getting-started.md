# Начало работы

Это руководство поможет вам интегрировать ApiPay.kz в ваше приложение и начать принимать платежи через Kaspi Pay.

## Подготовка

Перед созданием счетов необходимо:

1. **Получить API ключ** — Зарегистрируйтесь на [baypay.bazarbay.site](https://baypay.bazarbay.site/login) и получите API ключ в личном кабинете
2. **Настроить Kaspi Business** — Добавьте наш сервисный номер в приложение Kaspi Business
3. **Верифицировать организацию** — Пройдите верификацию в личном кабинете

## Шаг 1: Настройка Kaspi Business

1. Откройте приложение **Kaspi Business** на телефоне
2. Перейдите в **Настройки → Сотрудники → Добавить сотрудника**
3. Добавьте сервисный номер (см. Настройки → Подключение в личном кабинете)
4. Установите роль: **Бухгалтер**
5. Подтвердите добавление

> **Важно**: Этот шаг позволяет ApiPay.kz создавать счета от имени вашей организации.

## Шаг 2: Получение API ключа

1. Перейдите на [baypay.bazarbay.site/login](https://baypay.bazarbay.site/login)
2. Войдите через WhatsApp
3. Перейдите в **Настройки → Подключение**
4. Скопируйте ваш API ключ

## Шаг 3: Верификация организации

1. Перейдите в [Личный кабинет ApiPay.kz](https://baypay.bazarbay.site)
2. Откройте **Главная → Верификация**
3. Пройдите процесс верификации
4. Дождитесь подтверждения

## Шаг 4: Создание первого счёта

После верификации можно создавать счета:

```bash
curl -X POST https://bpapi.bazarbay.site/api/invoices \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 10000,
    "phone_number": "87001234567",
    "description": "Заказ #123"
  }'
```

**Ответ:**
```json
{
  "id": 42,
  "kaspi_invoice_id": "13234689513",
  "kaspi_qr_token": "abc123",
  "payment_url": "https://kaspi.kz/pay/...",
  "amount": "10000.00",
  "status": "pending",
  "created_at": "2025-01-31T12:00:00Z"
}
```

## Шаг 5: Редирект клиента

Перенаправьте клиента на `payment_url` для оплаты:

```javascript
// После создания счёта
window.location.href = data.payment_url
```

Клиент:
1. Откроет Kaspi Pay в браузере
2. Подтвердит сумму платежа
3. Оплатит картой Kaspi Gold

## Шаг 6: Обработка уведомлений об оплате

Настройте webhook для получения уведомлений о платежах в реальном времени. См. [Webhooks](webhooks.md).

## Конфигурация API

| Параметр | Значение |
|----------|----------|
| Base URL | `https://bpapi.bazarbay.site/api` |
| Аутентификация | Заголовок `X-API-Key: your_api_key` |
| Content-Type | `application/json` |
| Rate Limit | 60 запросов/минуту |

## Следующие шаги

- [Счета](invoices.md) — Управление счетами
- [Рекуррентные платежи](recurring.md) — Настройка подписок
- [Webhooks](webhooks.md) — Настройка уведомлений о платежах
- [Коды ошибок](errors.md) — Правильная обработка ошибок
