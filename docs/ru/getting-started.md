# Начало работы

Это руководство поможет вам интегрировать ApiPay.kz в ваше приложение и начать принимать платежи через Kaspi Pay.

## Подготовка

Перед созданием счетов необходимо:

1. **Получить API ключ** — Зарегистрируйтесь на [baypay.bazarbay.site](https://baypay.bazarbay.site/login) и получите API ключ в личном кабинете
2. **Подключить организацию** — Напишите в WhatsApp поддержки для подключения Kaspi Business
3. **Начать создавать счета** — После подключения используйте API или личный кабинет

## Шаг 1: Получение API ключа

1. Перейдите на [baypay.bazarbay.site/login](https://baypay.bazarbay.site/login)
2. Войдите через WhatsApp
3. Перейдите в **Настройки → Подключение**
4. Скопируйте ваш API ключ

## Шаг 2: Подключение организации

1. Напишите в [WhatsApp поддержки (+7 708 516 74 89)](https://wa.me/77085167489)
2. Укажите ваш ID из личного кабинета
3. Мы подключим ваш Kaspi Business с правами **Кассира**
4. Обычно это занимает 5-30 минут в рабочее время

> **Важно**: Это единственная ручная операция. После подключения всё работает автоматически.

## Шаг 4: Создание первого счёта

После верификации можно создавать счета:

```bash
curl -X POST https://bpapi.bazarbay.site/api/invoices \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 10000,
    "phone_number": "87001234567",
    "description": "Заказ #123"
  }'
```

**Ответ:**
```json
{
  "id": 42,
  "kaspi_invoice_id": "13234689513",
  "kaspi_qr_token": "abc123",
  "payment_url": "https://kaspi.kz/pay/...",
  "amount": "10000.00",
  "status": "pending",
  "created_at": "2025-01-31T12:00:00Z"
}
```

## Шаг 5: Редирект клиента

Перенаправьте клиента на `payment_url` для оплаты:

```javascript
// После создания счёта
window.location.href = data.payment_url
```

Клиент:
1. Откроет Kaspi Pay в браузере
2. Подтвердит сумму платежа
3. Оплатит картой Kaspi Gold

## Шаг 6: Обработка уведомлений об оплате

Настройте webhook для получения уведомлений о платежах в реальном времени. См. [Webhooks](webhooks.md).

## Конфигурация API

| Параметр | Значение |
|----------|----------|
| Base URL | `https://bpapi.bazarbay.site/api` |
| Аутентификация | Заголовок `X-API-Key: your_api_key` |
| Content-Type | `application/json` |
| Rate Limit | 60 запросов/минуту |

## Следующие шаги

- [Счета](invoices.md) — Управление счетами
- [Рекуррентные платежи](recurring.md) — Настройка подписок
- [Webhooks](webhooks.md) — Настройка уведомлений о платежах
- [Коды ошибок](errors.md) — Правильная обработка ошибок
